<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunch Choice Board</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            padding: 20px;
            transition: background 0.5s ease;
            touch-action: none;
            position: relative; /* Needed for absolute positioning of emoji layer */
        }

        /* NEW: Emoji Background Layer */
        .emoji-background { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to pass through */
            z-index: 0; /* Ensures it stays behind content */
            opacity: 0.15; /* Set to very low opacity */
            background-image: repeating-linear-gradient(
                45deg,
                transparent 0,
                transparent 100px,
                rgba(0, 0, 0, 0.05) 100px,
                rgba(0, 0, 0, 0.05) 200px
            );
        }
        
        /* NEW: Content for the Emoji Background */
        .emoji-background::before {
            content: "🍣🍜🍟🍕🍔🥗🌮🍇🍓🍌🥕🥦🧀🥚🥞🥣🍝🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍊🍗🍖🥩🥓🍿🌭🍤🥪🥙🧇🥛☕️🥤🧃🍕🍟🥗🥪🧀🥚🧇🥞🥣🍝🍣🍜🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍔🌭🍿🥓🥩🍗🍖🌮🌯🥙🍎🍇🍓🍌🍊🥕🥦🧀🥚🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍄🥛☕️🥤🧃🍕🍔🍟🌭🍿🥓🥩🍗🍖🌮🌯🥙🥗🥪🧀🥚🧇🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍣🍜🍟🍕🍔🥗🌮🍇🍓🍌🥕🥦🧀🥚🥞🥣🍝🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍊🍗🍖🥩🥓🍿🌭🍤🥪🥙🧇🥛☕️🥤🧃🍕🍟🥗🥪🧀🥚🧇🥞🥣🍝🍣🍜🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍔🌭🍿🥓🥩🍗🍖🌮🌯🥙🍎🍇🍓🍌🍊🥕🥦🧀🥚🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍄🥛☕️🥤🧃🍕🍔🍟🌭🍿🥓🥩🍗🍖🌮🌯🥙🥗🥪🧀🥚🧇🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍣🍜🍟🍕🍔🥗🌮🍇🍓🍌🥕🥦🧀🥚🥞🥣🍝🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍊🍗🍖🥩🥓🍿🌭🍤🥪🥙🧇🥛☕️🥤🧃🍕🍟🥗🥪🧀🥚🧇🥞🥣🍝🍣🍜🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍔🌭🍿🥓🥩🍗🍖🌮🌯🥙🍎🍇🍓🍌🍊🥕🥦🧀🥚🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍄🥛☕️🥤🧃🍕🍔🍟🌭🍿🥓🥩🍗🍖🌮🌯🥙🥗🥪🧀🥚🧇🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍣🍜🍟🍕🍔🥗🌮🍇🍓🍌🥕🥦🧀🥚🥞🥣🍝🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍊🍗🍖🥩🥓🍿🌭🍤🥪🥙🧇🥛☕️🥤🧃🍕🍟🥗🥪🧀🥚🧇🥞🥣🍝🍣🍜🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃🍔🌭🍿🥓🥩🍗🍖🌮🌯🥙🍎🍇🍓🍌🍊🥕🥦🧀🥚🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍄🥛☕️🥤🧃🍕🍔🍟🌭🍿🥓🥩🍗🍖🌮🌯🥙🥗🥪🧀🥚🧇🥞🥣🍝🍜🍣🍤🍚🍙🍞🥐🥨🍩🍪🎂🍰🍦🍧🍬🍭🍫🍯🍎🍇🍓🍌🍊🥕🥦🍄🥛☕️🥤🧃"; /* Your Food Emojis */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: 50px; /* Adjust size as needed */
            line-height: 1.5;
            word-break: break-all;
            white-space: pre-wrap;
            opacity: 1; /* Apply the main opacity to the container, not the content */
            color: #ffffff; /* Make the emojis white/light to contrast with dark background */
        }
        /* End NEW Emoji Background Styles */


        /* Color Palettes */
        .palette-0 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .palette-1 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .palette-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .palette-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .palette-4 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .palette-5 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .palette-6 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .palette-7 { background: linear-gradient(135deg, #30336b 0%, #130f40 100%); }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            position: relative; /* Bring to front of emoji layer */
            z-index: 1;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .setup-page {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            text-align: center;
            position: relative; /* Bring to front of emoji layer */
            z-index: 1;
        }

        .setup-page h2 {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .palette-selector {
            margin-bottom: 15px;
            text-align: center;
        }

        .palette-selector h3 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .palette-grid {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .palette-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .palette-option:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .palette-option.selected {
            border-color: white;
            border-width: 4px;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(255,255,255,0.4);
        }

        .palette-note {
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
            font-style: italic;
        }

        .setup-textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            resize: vertical;
            background: rgba(255,255,255,0.95);
        }

        .setup-textarea::placeholder {
            color: #666;
            font-style: italic;
        }

        .generate-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .generate-btn:hover {
            background: #3d8bfe;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .url-result {
            margin-top: 20px;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .url-result h3 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .url-display {
            background: rgba(255,255,255,0.9);
            padding: 8px;
            border-radius: 5px;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .url-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .copy-btn, .load-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover, .load-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative; /* Bring to front of emoji layer */
            z-index: 1;
        }

        .control-group {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .control-group label {
            color: white;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input[type="text"] {
            padding: 6px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            width: 180px;
        }

        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
        }

        button:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .main-container {
            display: flex;
            gap: 10px;
            min-height: 500px;
            position: relative; /* Bring to front of emoji layer */
            z-index: 1;
        }

        .students-section {
            flex: 1;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .choices-section {
            flex: 2;
            display: flex;
            gap: 10px;
        }

        .section-title {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .students-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        /* The core draggable element */
        .student-puck, .student-in-choice {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 10px 14px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            cursor: grab; /* Set cursor to indicate grab */
            transition: all 0.3s ease;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            min-width: 100px;
            text-align: center;
            touch-action: none; /* Prevent browser from handling touch */
            position: relative; /* Essential for positioning when dragging */
            z-index: 1;
        }
        
        .student-puck.dragging, .student-in-choice.dragging {
            position: fixed; /* Use fixed for smooth dragging over all elements */
            transform: translate(var(--drag-x), var(--drag-y)) scale(1.1) rotate(5deg);
            z-index: 1000;
            opacity: 0.8;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            cursor: grabbing; /* Change cursor while dragging */
            transition: none; /* Disable transition during drag for smoothness */
        }
        
        .student-puck:hover, .student-in-choice:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }

        .choice-column {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 3px dashed rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            min-height: 350px;
            display: flex;
            flex-direction: column;
        }

        .choice-column.drag-over {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.2);
            transform: scale(1.02);
        }

        .choice-title {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .choice-title input {
            background: transparent;
            border: none;
            color: white;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
        }

        .choice-title input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .choice-students {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            padding: 8px;
        }

        /* Styles for when the choice column is "packed" with students */
        .choice-column.packed .choice-students {
            flex-direction: row; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 5px; 
        }
        
        .choice-column.packed .student-in-choice {
            width: calc(50% - 5px); 
            max-width: 160px; 
            font-size: 10px;
            padding: 6px 8px;
            min-height: auto;
        }

        .choice-count {
            background: #ff6b6b;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: bold;
            text-align: center;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .choices-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="palette-0"> <div class="emoji-background"></div>

    <div class="header">
        <h1>🍽️ Lunch Choice Board 🍽️</h1>
    </div>

    <div id="setupPage" class="setup-page">
        <h2>Create Your Lunch Choice Board</h2>
        <p>Choose your color theme and enter your students' names to generate your personalized lunch choice board.</p>
        
        <div class="palette-selector">
            <h3>Choose Your Color Theme:</h3>
            <div class="palette-grid">
                <div class="palette-option" data-palette="0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" title="Classic Purple"></div>
                <div class="palette-option" data-palette="1" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" title="Berry Blast"></div>
                <div class="palette-option" data-palette="2" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" title="Ocean Blue"></div>
                <div class="palette-option" data-palette="3" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" title="Fresh Green"></div>
                <div class="palette-option" data-palette="4" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" title="Sunset Glow"></div>
                <div class="palette-option" data-palette="5" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);" title="Soft Pastels"></div>
                <div class="palette-option" data-palette="6" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);" title="Cotton Candy"></div>
                <div class="palette-option" data-palette="7" style="background: linear-gradient(135deg, #30336b 0%, #130f40 100%);" title="Midnight Dark"></div>
            </div>
            <p class="palette-note">Selected: <span id="selectedPaletteName">Classic Purple</span></p>
        </div>
        
        <textarea id="setupStudentNames" class="setup-textarea" placeholder="Emma, Liam, Olivia, Noah, Ava, Elijah, Sophia, Lucas, Isabella, Mason, Mia, Ethan, Charlotte, Alexander, Amelia, Michael, Harper, Benjamin, Evelyn, Jacob, Abigail..."></textarea>
        
        <button onclick="generateBoard()" class="generate-btn">Generate Choice Board</button>
        
        <div id="urlResult" class="url-result hidden">
            <h3>Your Personal Lunch Board URL:</h3>
            <div id="urlDisplay" class="url-display"></div>
            <div class="url-buttons">
                <button onclick="copyUrl()" class="copy-btn">Copy URL</button>
                <button onclick="loadBoard()" class="load-btn">Load Board Now</button>
            </div>
        </div>
    </div>

    <div id="mainBoard" class="hidden">
        <div class="controls">
            <div class="control-group">
                <label>School Lunch 1:</label>
                <input type="text" id="lunch1" placeholder="e.g., Pizza & Fruit">
            </div>
            <div class="control-group">
                <label>School Lunch 2:</label>
                <input type="text" id="lunch2" placeholder="e.g., Chicken & Veggies">
            </div>
            <div class="control-group">
                <label>School Lunch 3:</label>
                <input type="text" id="lunch3" placeholder="e.g., Salad & Soup">
            </div>
            <div class="control-group">
                <button onclick="resetBoard()">Reset Board</button>
                <button onclick="backToSetup()">New Student List</button>
            </div>
        </div>

        <div class="main-container">
            <div class="students-section" data-choice="unassigned">
                <div class="section-title">Students</div>
                <div class="students-grid" id="studentsGrid"></div>
            </div>

            <div class="choices-section">
                <div class="choice-column" data-choice="lunch1">
                    <div class="choice-title">
                        <input type="text" id="lunch1Title" placeholder="School Lunch 1" readonly>
                    </div>
                    <div class="choice-students" id="lunch1Students"></div>
                    <div class="choice-count" id="lunch1Count">Count: 0</div>
                </div>

                <div class="choice-column" data-choice="lunch2">
                    <div class="choice-title">
                        <input type="text" id="lunch2Title" placeholder="School Lunch 2" readonly>
                    </div>
                    <div class="choice-students" id="lunch2Students"></div>
                    <div class="choice-count" id="lunch2Count">Count: 0</div>
                </div>

                <div class="choice-column" data-choice="lunch3">
                    <div class="choice-title">
                        <input type="text" id="lunch3Title" placeholder="School Lunch 3" readonly>
                    </div>
                    <div class="choice-students" id="lunch3Students"></div>
                    <div class="choice-count" id="lunch3Count">Count: 0</div>
                </div>

                <div class="choice-column" data-choice="home">
                    <div class="choice-title">🏠 Home Lunch</div>
                    <div class="choice-students" id="homeStudents"></div>
                    <div class="choice-count" id="homeCount">Count: 0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let students = [];
        let choices = {
            lunch1: [],
            lunch2: [],
            lunch3: [],
            home: []
        };
        let generatedUrl = '';
        let selectedPalette = 0;
        const studentsPerColumn = 7;
        
        const paletteNames = [
            "Classic Purple", "Berry Blast", "Ocean Blue", "Fresh Green",
            "Sunset Glow", "Soft Pastels", "Cotton Candy", "Midnight Dark"
        ];

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const studentsParam = urlParams.get('students');
            const paletteParam = urlParams.get('palette');
            
            if (paletteParam !== null) {
                selectedPalette = parseInt(paletteParam) || 0;
            }
            applyPalette(selectedPalette);
            
            if (studentsParam) {
                students = studentsParam.split(',').map(name => decodeURIComponent(name.trim())).filter(name => name);
                showMainBoard();
                updateDisplay();
            } else {
                showSetupPage();
                initializePaletteSelector();
            }
        };

        function initializePaletteSelector() {
            const paletteOptions = document.querySelectorAll('.palette-option');
            paletteOptions[selectedPalette].classList.add('selected');
            document.getElementById('selectedPaletteName').textContent = paletteNames[selectedPalette];
            
            paletteOptions.forEach((option, index) => {
                option.addEventListener('click', function() {
                    paletteOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPalette = index;
                    document.getElementById('selectedPaletteName').textContent = paletteNames[index];
                    applyPalette(selectedPalette);
                });
            });
        }

        function applyPalette(paletteIndex) {
            for (let i = 0; i <= 7; i++) {
                document.body.classList.remove(`palette-${i}`);
            }
            document.body.classList.add(`palette-${paletteIndex}`);
        }

        function showSetupPage() {
            document.getElementById('setupPage').classList.remove('hidden');
            document.getElementById('mainBoard').classList.add('hidden');
            initializePaletteSelector();
        }

        function showMainBoard() {
            document.getElementById('setupPage').classList.add('hidden');
            document.getElementById('mainBoard').classList.remove('hidden');
        }

        function generateBoard() {
            const namesInput = document.getElementById('setupStudentNames').value;
            if (!namesInput.trim()) {
                showMessage('Please enter student names first!', '#ff6b6b');
                return;
            }

            students = namesInput.split(',').map(name => name.trim()).filter(name => name);
            
            const baseUrl = window.location.href.split('?')[0];
            const encodedStudents = students.map(name => encodeURIComponent(name)).join(',');
            generatedUrl = `${baseUrl}?students=${encodedStudents}&palette=${selectedPalette}`;
            
            document.getElementById('urlDisplay').textContent = generatedUrl;
            document.getElementById('urlResult').classList.remove('hidden');
        }

        function showMessage(text, color) {
            const messageBox = document.createElement('div');
            messageBox.textContent = text;
            messageBox.style.cssText = `position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: ${color}; color: white; padding: 20px; border-radius: 10px; z-index: 9999; box-shadow: 0 4px 8px rgba(0,0,0,0.2); text-align: center;`;
            document.body.appendChild(messageBox);
            setTimeout(() => messageBox.remove(), 2000);
        }

        function copyUrl() {
            navigator.clipboard.writeText(generatedUrl).then(function() {
                showMessage('URL Copied!', '#4facfe');
            }).catch(function() {
                const textArea = document.createElement('textarea');
                textArea.value = generatedUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showMessage('URL Copied!', '#4facfe');
            });
        }

        function loadBoard() {
            choices = { lunch1: [], lunch2: [], lunch3: [], home: [] };
            showMainBoard();
            updateDisplay();
        }

        function backToSetup() {
            const messageBox = document.createElement('div');
            messageBox.textContent = 'Are you sure you want to create a new student list? This will clear the current board.';
            messageBox.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #ff6b6b; color: white; padding: 20px; border-radius: 10px; z-index: 9999; box-shadow: 0 4px 8px rgba(0,0,0,0.2);';
            
            const confirmBtn = document.createElement('button');
            confirmBtn.textContent = 'Confirm';
            confirmBtn.style.cssText = 'background: #43e97b; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;';
            confirmBtn.onclick = () => {
                history.pushState({}, '', window.location.href.split('?')[0]);
                students = [];
                choices = { lunch1: [], lunch2: [], lunch3: [], home: [] };
                document.getElementById('setupStudentNames').value = '';
                document.getElementById('urlResult').classList.add('hidden');
                showSetupPage();
                messageBox.remove();
            };

            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.style.cssText = 'background: #d3d3d3; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px; margin-top: 10px;';
            cancelBtn.onclick = () => {
                messageBox.remove();
            };

            messageBox.appendChild(document.createElement('br'));
            messageBox.appendChild(confirmBtn);
            messageBox.appendChild(cancelBtn);
            document.body.appendChild(messageBox);
        }

        document.getElementById('lunch1').addEventListener('input', function() {
            document.getElementById('lunch1Title').value = this.value;
        });
        document.getElementById('lunch2').addEventListener('input', function() {
            document.getElementById('lunch2Title').value = this.value;
        });
        document.getElementById('lunch3').addEventListener('input', function() {
            document.getElementById('lunch3Title').value = this.value;
        });

        function updateDisplay() {
            updateStudentsGrid();
            updateChoiceColumns();
            updateCounts();
            
            document.getElementById('lunch1Title').value = document.getElementById('lunch1').value;
            document.getElementById('lunch2Title').value = document.getElementById('lunch2').value;
            document.getElementById('lunch3Title').value = document.getElementById('lunch3').value;
        }

        function updateStudentsGrid() {
            const grid = document.getElementById('studentsGrid');
            grid.innerHTML = '';
            const assignedStudents = [...choices.lunch1, ...choices.lunch2, ...choices.lunch3, ...choices.home];
            const unassignedStudents = students.filter(student => !assignedStudents.includes(student));

            unassignedStudents.forEach(student => {
                grid.appendChild(createStudentPuck(student));
            });
        }

        function createStudentPuck(studentName) {
            const puck = document.createElement('div');
            puck.className = 'student-puck';
            puck.textContent = studentName;
            puck.dataset.student = studentName;
            return puck;
        }

        function updateChoiceColumns() {
            ['lunch1', 'lunch2', 'lunch3', 'home'].forEach(choiceType => {
                const container = document.getElementById(choiceType + 'Students');
                const column = container.closest('.choice-column');
                container.innerHTML = '';
                
                if (choices[choiceType].length > studentsPerColumn) {
                    column.classList.add('packed');
                } else {
                    column.classList.remove('packed');
                }
                
                choices[choiceType].forEach(student => {
                    const studentElement = createStudentPuck(student);
                    studentElement.classList.remove('student-puck');
                    studentElement.classList.add('student-in-choice');
                    container.appendChild(studentElement);
                });
            });
        }

        function updateCounts() {
            ['lunch1', 'lunch2', 'lunch3', 'home'].forEach(choiceType => {
                const count = choices[choiceType].length;
                document.getElementById(choiceType + 'Count').textContent = `Count: ${count}`;
            });
        }

        function resetBoard() {
            const messageBox = document.createElement('div');
            messageBox.textContent = 'Are you sure you want to reset the board? This will move all students back to the unassigned area.';
            messageBox.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #ff6b6b; color: white; padding: 20px; border-radius: 10px; z-index: 9999; box-shadow: 0 4px 8px rgba(0,0,0,0.2); text-align: center;';
            
            const confirmBtn = document.createElement('button');
            confirmBtn.textContent = 'Confirm';
            confirmBtn.style.cssText = 'background: #43e97b; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;';
            confirmBtn.onclick = () => {
                choices = { lunch1: [], lunch2: [], lunch3: [], home: [] };
                updateDisplay();
                messageBox.remove();
            };

            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.style.cssText = 'background: #d3d3d3; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px; margin-top: 10px;';
            cancelBtn.onclick = () => {
                messageBox.remove();
            };

            messageBox.appendChild(document.createElement('br'));
            messageBox.appendChild(confirmBtn);
            messageBox.appendChild(cancelBtn);
            document.body.appendChild(messageBox);
        }

        // Custom Drag & Drop Logic
        let draggedElement = null;
        let draggedClone = null;
        let offsetX = 0, offsetY = 0;

        document.addEventListener('mousedown', startDrag);
        document.addEventListener('touchstart', startDrag, { passive: false });

        function startDrag(e) {
            const target = e.target.closest('.student-puck, .student-in-choice');
            if (target) {
                e.preventDefault();
                draggedElement = target;
                
                const rect = draggedElement.getBoundingClientRect();
                const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;
                
                // Calculate offset from pointer to element's top-left corner
                offsetX = clientX - rect.left;
                offsetY = clientY - rect.top;
                
                // Create a clone for dragging
                draggedClone = draggedElement.cloneNode(true);
                draggedClone.style.position = 'fixed';
                draggedClone.style.left = `${rect.left}px`;
                draggedClone.style.top = `${rect.top}px`;
                draggedClone.style.width = `${rect.width}px`;
                draggedClone.style.margin = '0';
                draggedClone.style.zIndex = '1000';
                draggedClone.style.pointerEvents = 'none';
                draggedClone.classList.add('dragging');
                document.body.appendChild(draggedClone);
                
                // Hide the original element
                draggedElement.style.opacity = '0.3';

                if (e.type === 'touchstart') {
                    document.addEventListener('touchmove', doDrag, { passive: false });
                    document.addEventListener('touchend', endDrag);
                } else {
                    document.addEventListener('mousemove', doDrag);
                    document.addEventListener('mouseup', endDrag);
                }
            }
        }

        function doDrag(e) {
            if (!draggedClone) return;
            e.preventDefault();

            const clientX = e.type.startsWith('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.startsWith('touch') ? e.touches[0].clientY : e.clientY;

            // Position clone so it follows the pointer, accounting for the offset
            draggedClone.style.left = `${clientX - offsetX}px`;
            draggedClone.style.top = `${clientY - offsetY}px`;

            const dropZone = document.elementFromPoint(clientX, clientY)?.closest('.choice-column, .students-section');

            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        function endDrag(e) {
            if (!draggedElement) return;

            const clientX = e.type.startsWith('touch') ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.type.startsWith('touch') ? e.changedTouches[0].clientY : e.clientY;
            
            const dropZone = document.elementFromPoint(clientX, clientY)?.closest('.choice-column, .students-section');
            const studentName = draggedElement.dataset.student;
            
            Object.keys(choices).forEach(key => {
                choices[key] = choices[key].filter(student => student !== studentName);
            });
            
            if (dropZone) {
                const choiceType = dropZone.dataset.choice;
                if (choiceType !== 'unassigned') {
                    choices[choiceType].push(studentName);
                }
            }
            
            // Clean up CSS for the original element
            draggedElement.style.opacity = '1'; // Restore full opacity to the original element
            
            // NEW: Remove the temporary dragging clone
            if (draggedClone && draggedClone.parentNode) {
                draggedClone.parentNode.removeChild(draggedClone); 
            }
            draggedClone = null; // Reset the global clone variable

            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            
            document.removeEventListener('mousemove', doDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', doDrag);
            document.removeEventListener('touchend', endDrag);
            draggedElement = null;
            
            updateDisplay();
        }
    </script>
</body>
</html>